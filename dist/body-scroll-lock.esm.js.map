{"version":3,"file":"body-scroll-lock.esm.js","sources":["../src/index.ts"],"sourcesContent":["// Adopted and modified solution from Bohdan Didukh (2017)\n// https://stackoverflow.com/questions/41594997/ios-10-safari-prevent-scrolling-behind-a-fixed-overlay-and-maintain-scroll-posi\n\nexport interface BodyScrollOptions {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  reserveScrollBarGap?: boolean\n  allowTouchMove?: (el: any) => boolean\n}\n\ninterface Lock {\n  targetElement: any\n  options: BodyScrollOptions\n}\n\n// Older browsers don't support event options, feature detect it.\nlet hasPassiveEvents = false\nif (typeof window !== 'undefined') {\n  const passiveTestOptions = {\n    get passive() {\n      hasPassiveEvents = true\n      return undefined\n    },\n  }\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  const listener = (): void => {}\n  window.addEventListener('testPassive', listener, passiveTestOptions)\n  window.removeEventListener(\n    'testPassive',\n    listener,\n    passiveTestOptions as EventListenerOptions\n  )\n}\n\nconst isIosDevice =\n  typeof window !== 'undefined' &&\n  window.navigator &&\n  window.navigator.platform &&\n  (/iP(ad|hone|od)/.test(window.navigator.platform) ||\n    (window.navigator.platform === 'MacIntel' &&\n      window.navigator.maxTouchPoints > 1))\ntype HandleScrollEvent = TouchEvent\n\nlet locks: Lock[] = []\nlet documentListenerAdded = false\nlet initialClientY = -1\nlet previousBodyOverflowSetting: string | undefined\nlet previousBodyPaddingRight: string | undefined\n\n// returns true if `el` should be allowed to receive touchmove events.\nconst allowTouchMove = (el: EventTarget | null): boolean =>\n  locks.some(\n    lock => lock.options.allowTouchMove && lock.options.allowTouchMove(el)\n  )\n\nconst preventDefault = (rawEvent: HandleScrollEvent): boolean => {\n  const e = rawEvent || (window.event as HandleScrollEvent)\n\n  // For the case whereby consumers adds a touchmove event listener to document.\n  // Recall that we do document.addEventListener('touchmove', preventDefault, { passive: false })\n  // in disableBodyScroll - so if we provide this opportunity to allowTouchMove, then\n  // the touchmove event on document will break.\n  if (allowTouchMove(e.target)) {\n    return true\n  }\n\n  // Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom).\n  if (e.touches.length > 1) return true\n\n  if (e.preventDefault) e.preventDefault()\n\n  return false\n}\n\nconst setOverflowHidden = (options?: BodyScrollOptions): void => {\n  // If previousBodyPaddingRight is already set, don't set it again.\n  if (previousBodyPaddingRight === undefined) {\n    const reserveScrollBarGap =\n      !!options && options.reserveScrollBarGap === true\n    const scrollBarGap =\n      window.innerWidth - document.documentElement.clientWidth\n\n    if (reserveScrollBarGap && scrollBarGap > 0) {\n      const computedBodyPaddingRight = parseInt(\n        window\n          .getComputedStyle(document.body)\n          .getPropertyValue('padding-right'),\n        10\n      )\n      previousBodyPaddingRight = document.body.style.paddingRight\n      document.body.style.paddingRight = `${computedBodyPaddingRight +\n        scrollBarGap}px`\n    }\n  }\n\n  // If previousBodyOverflowSetting is already set, don't set it again.\n  if (previousBodyOverflowSetting === undefined) {\n    previousBodyOverflowSetting = document.body.style.overflow\n    document.body.style.overflow = 'hidden'\n  }\n}\n\nconst restoreOverflowSetting = (): void => {\n  if (previousBodyPaddingRight !== undefined) {\n    document.body.style.paddingRight = previousBodyPaddingRight\n\n    // Restore previousBodyPaddingRight to undefined so setOverflowHidden knows it\n    // can be set again.\n    previousBodyPaddingRight = undefined\n  }\n\n  if (previousBodyOverflowSetting !== undefined) {\n    document.body.style.overflow = previousBodyOverflowSetting\n\n    // Restore previousBodyOverflowSetting to undefined\n    // so setOverflowHidden knows it can be set again.\n    previousBodyOverflowSetting = undefined\n  }\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight#Problems_and_solutions\nconst isTargetElementTotallyScrolled = (targetElement: any): boolean =>\n  targetElement\n    ? targetElement.scrollHeight - targetElement.scrollTop <=\n      targetElement.clientHeight\n    : false\n\nconst handleScroll = (\n  event: HandleScrollEvent,\n  targetElement: any\n): boolean => {\n  const clientY = event.targetTouches[0].clientY - initialClientY\n\n  if (allowTouchMove(event.target)) {\n    return false\n  }\n\n  if (targetElement && targetElement.scrollTop === 0 && clientY > 0) {\n    // element is at the top of its scroll.\n    return preventDefault(event)\n  }\n\n  if (isTargetElementTotallyScrolled(targetElement) && clientY < 0) {\n    // element is at the bottom of its scroll.\n    return preventDefault(event)\n  }\n\n  event.stopPropagation()\n  return true\n}\n\nexport const disableBodyScroll = (\n  targetElement: any,\n  options?: BodyScrollOptions\n): void => {\n  // targetElement must be provided\n  if (!targetElement) {\n    // eslint-disable-next-line no-console\n    console.error(\n      'disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.'\n    )\n    return\n  }\n\n  // disableBodyScroll must not have been called on this targetElement before\n  if (locks.some(lock => lock.targetElement === targetElement)) {\n    return\n  }\n\n  const lock = {\n    targetElement,\n    options: options || {},\n  }\n\n  locks = [...locks, lock]\n\n  setOverflowHidden(options)\n\n  if (isIosDevice) {\n    targetElement.ontouchstart = (event: HandleScrollEvent) => {\n      if (event.targetTouches.length === 1) {\n        // detect single touch.\n        initialClientY = event.targetTouches[0].clientY\n      }\n    }\n    targetElement.ontouchmove = (event: HandleScrollEvent) => {\n      if (event.targetTouches.length === 1) {\n        // detect single touch.\n        handleScroll(event, targetElement)\n      }\n    }\n\n    if (!documentListenerAdded) {\n      // eslint-disable-next-line @typescript-eslint/naming-convention\n      document.addEventListener(\n        'touchmove',\n        preventDefault,\n        hasPassiveEvents ? { passive: false } : undefined\n      )\n      documentListenerAdded = true\n    }\n  }\n}\n\nexport const clearAllBodyScrollLocks = (): void => {\n  restoreOverflowSetting()\n\n  if (isIosDevice) {\n    // Clear all locks ontouchstart/ontouchmove handlers, and the references.\n    locks.forEach((lock: Lock) => {\n      lock.targetElement.ontouchstart = null\n      lock.targetElement.ontouchmove = null\n    })\n\n    if (documentListenerAdded) {\n      document.removeEventListener(\n        'touchmove',\n        preventDefault,\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        hasPassiveEvents\n          ? ({ passive: false } as EventListenerOptions)\n          : undefined\n      )\n      documentListenerAdded = false\n    }\n\n    // Reset initial clientY.\n    initialClientY = -1\n  }\n\n  locks = []\n}\n\nexport const enableBodyScroll = (targetElement: any): void => {\n  if (!targetElement) {\n    // eslint-disable-next-line no-console\n    console.error(\n      'enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.'\n    )\n    return\n  }\n\n  locks = locks.filter(lock => lock.targetElement !== targetElement)\n\n  if (!locks.length) {\n    restoreOverflowSetting()\n  }\n\n  if (isIosDevice) {\n    targetElement.ontouchstart = null\n    targetElement.ontouchmove = null\n\n    if (documentListenerAdded && locks.length === 0) {\n      document.removeEventListener(\n        'touchmove',\n        preventDefault,\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        hasPassiveEvents\n          ? ({ passive: false } as EventListenerOptions)\n          : undefined\n      )\n      documentListenerAdded = false\n    }\n  }\n}\n"],"names":["hasPassiveEvents","window","passiveTestOptions","passive","undefined","listener","addEventListener","removeEventListener","isIosDevice","navigator","platform","test","maxTouchPoints","locks","documentListenerAdded","initialClientY","previousBodyOverflowSetting","previousBodyPaddingRight","allowTouchMove","el","some","lock","options","preventDefault","rawEvent","e","event","target","touches","length","setOverflowHidden","reserveScrollBarGap","scrollBarGap","innerWidth","document","documentElement","clientWidth","computedBodyPaddingRight","parseInt","getComputedStyle","body","getPropertyValue","style","paddingRight","overflow","restoreOverflowSetting","isTargetElementTotallyScrolled","targetElement","scrollHeight","scrollTop","clientHeight","handleScroll","clientY","targetTouches","stopPropagation","disableBodyScroll","console","error","ontouchstart","ontouchmove","clearAllBodyScrollLocks","forEach","enableBodyScroll","filter"],"mappings":"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"}